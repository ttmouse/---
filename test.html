<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°èœœèœ‚æ¸¸æˆ - å…ƒç´ æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #ffff00;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 2px solid #333;
            border-radius: 10px;
            background: #111;
        }
        .section h2 {
            color: #00ff00;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }
        .canvas-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .test-canvas {
            border: 1px solid #666;
            background: linear-gradient(to bottom, #001122, #003366);
        }
        .element-info {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            background: #333;
            color: #fff;
            border: 1px solid #666;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #555;
        }
        button.active {
            background: #007700;
        }
        .description {
            margin-top: 10px;
            padding: 10px;
            background: #222;
            border-radius: 5px;
            font-size: 12px;
            line-height: 1.4;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .stat-item {
            background: #333;
            padding: 8px;
            border-radius: 3px;
            font-size: 12px;
        }
        .param-controls {
            margin-top: 15px;
            padding: 15px;
            background: #222;
            border-radius: 5px;
            border: 1px solid #444;
        }
        .param-group {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .param-group label {
            min-width: 80px;
            font-size: 12px;
            color: #ccc;
        }
        .param-group input[type="range"] {
            flex: 1;
            min-width: 100px;
        }
        .param-group input[type="color"] {
            width: 40px;
            height: 25px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .param-group .value-display {
            min-width: 40px;
            font-size: 12px;
            color: #fff;
            background: #444;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .number-input {
            width: 70px;
            padding: 5px;
            border: 1px solid #555;
            border-radius: 4px;
            background: #333;
            color: #fff;
            text-align: center;
            font-size: 12px;
        }
        .number-input:focus {
            outline: none;
            border-color: #007acc;
            box-shadow: 0 0 5px rgba(0, 122, 204, 0.3);
        }
        .toggle-params {
            background: #444;
            color: #fff;
            border: 1px solid #666;
            padding: 5px 10px;
            margin-top: 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .toggle-params:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ å°èœœèœ‚æ¸¸æˆ - å…ƒç´ æµ‹è¯•é¡µé¢</h1>
        
        <div class="controls">
            <button onclick="startAnimation()" id="animBtn">å¼€å§‹åŠ¨ç”»</button>
            <button onclick="stopAnimation()">åœæ­¢åŠ¨ç”»</button>
            <button onclick="resetAll()">é‡ç½®æ‰€æœ‰</button>
            <button onclick="exportConfig()" style="background: #006600;">å¯¼å‡ºé…ç½®</button>
            <button onclick="saveToFiles()" style="background: #cc6600;">ä¿å­˜åˆ°æ–‡ä»¶</button>
        </div>

        <!-- æ•Œæœºå±•ç¤º -->
        <div class="section">
            <h2>ğŸš æ•Œæœºç±»å‹å±•ç¤º</h2>
            <div class="canvas-container" id="enemyContainer">
                <!-- æ•Œæœºç”»å¸ƒå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- å­å¼¹å±•ç¤º -->
        <div class="section">
            <h2>ğŸ’¥ å­å¼¹ç±»å‹å±•ç¤º</h2>
            <div class="canvas-container" id="bulletContainer">
                <!-- å­å¼¹ç”»å¸ƒå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- é“å…·å±•ç¤º -->
        <div class="section">
            <h2>ğŸ é“å…·ç±»å‹å±•ç¤º</h2>
            <div class="canvas-container" id="powerupContainer">
                <!-- é“å…·ç”»å¸ƒå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ç©å®¶é£æœºå±•ç¤º -->
        <div class="section">
            <h2>âœˆï¸ ç©å®¶é£æœºå±•ç¤º</h2>
            <div class="canvas-container">
                <div>
                    <canvas class="test-canvas" width="200" height="150" id="playerCanvas"></canvas>
                    <div class="element-info">
                        <strong>ç©å®¶é£æœº</strong>
                        <div class="description">
                            ç©å®¶æ§åˆ¶çš„å°èœœèœ‚ï¼Œå¯ä»¥ç§»åŠ¨å’Œå°„å‡»
                        </div>
                        <div class="stats">
                            <div class="stat-item">å°ºå¯¸: 40x30</div>
                            <div class="stat-item">é€Ÿåº¦: 5</div>
                            <div class="stat-item">ç”Ÿå‘½: 3</div>
                            <div class="stat-item">é¢œè‰²: é»„è‰²</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥æ¸¸æˆæ–‡ä»¶ -->
    <script src="bullet.js"></script>
    <script src="enemy.js"></script>
    <script src="powerup.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let animationRunning = false;
        let animationId = null;
        let enemyInstances = {};
        let bulletInstances = {};
        let powerupInstances = {};
        
        // æ•Œæœºç±»å‹é…ç½®
        const enemyTypes = [
            {
                type: 'normal',
                name: 'æ™®é€šæ•Œæœº',
                description: 'åŸºç¡€æ•Œæœºï¼Œæ©™è‰²ï¼Œä¸­ç­‰é€Ÿåº¦å’Œè¡€é‡',
                color: '#ff6600'
            },
            {
                type: 'fast',
                name: 'å¿«é€Ÿæ•Œæœº',
                description: 'é»„è‰²æ–¹å—ï¼Œç§»åŠ¨é€Ÿåº¦å¿«ï¼Œè¡€é‡è¾ƒä½ï¼ŒZå­—å½¢ç§»åŠ¨',
                color: '#ffff00'
            },
            {
                type: 'heavy',
                name: 'é‡å‹æ•Œæœº',
                description: 'æ£•è‰²ï¼Œä½“ç§¯å¤§ï¼Œè¡€é‡é«˜ï¼Œç§»åŠ¨ç¼“æ…¢ï¼Œå‘å°„ä¸‰è¿å‘',
                color: '#8B4513'
            },
            {
                type: 'armored',
                name: 'è£…ç”²æ•Œæœº',
                description: 'ç°è‰²ï¼Œä¸­ç­‰ä½“ç§¯ï¼Œå‘å°„ç©¿é€å­å¼¹',
                color: '#808080'
            },
            {
                type: 'scout',
                name: 'ä¾¦å¯Ÿæœº',
                description: 'ç»¿è‰²èœ»èœ“ï¼Œå¿«é€Ÿç§»åŠ¨ï¼Œä¼šé€ƒè·‘',
                color: '#00ff88'
            },
            {
                type: 'boss',
                name: 'Bossèœ˜è››',
                description: 'çº¢è‰²å¤§å‹èœ˜è››Bossï¼Œå¤šé˜¶æ®µæ”»å‡»æ¨¡å¼',
                color: '#ff0000'
            }
        ];

        // å­å¼¹ç±»å‹é…ç½®
        const bulletTypes = [
            {
                type: 'player',
                name: 'ç©å®¶å­å¼¹',
                description: 'é»„è‰²é’ˆçŠ¶ï¼Œå‘ä¸Šå‘å°„',
                color: '#ffff00'
            },
            {
                type: 'enemy',
                name: 'æ•Œæœºå­å¼¹',
                description: 'æ©™è‰²æ¤­åœ†ï¼Œå¯è¢«æŠµæ¶ˆ',
                color: '#ff6600'
            },
            {
                type: 'fast',
                name: 'å¿«é€Ÿå­å¼¹',
                description: 'é»„è‰²ï¼Œé€Ÿåº¦å¿«',
                color: '#ffff00'
            },
            {
                type: 'heavy',
                name: 'é‡å‹å­å¼¹',
                description: 'çº¢è‰²åœ†å½¢ï¼Œä¼¤å®³é«˜',
                color: '#ff4400'
            },
            {
                type: 'piercing',
                name: 'ç©¿é€å­å¼¹',
                description: 'ç´«è‰²ï¼Œä¸å¯æŠµæ¶ˆï¼ŒBosså‘å°„',
                color: '#ff00ff'
            },
            {
                type: 'venom',
                name: 'æ¯’æ¶²å­å¼¹',
                description: 'ç»¿è‰²ï¼Œä¸å¯æŠµæ¶ˆï¼ŒBosså‘å°„',
                color: '#00ff62'
            },
            {
                type: 'powerShot',
                name: 'å¼ºåŒ–å­å¼¹',
                description: 'é»„è‰²ï¼Œå¸¦è½¨è¿¹æ•ˆæœ',
                color: '#ffff00'
            },
            {
                type: 'tracking',
                name: 'è·Ÿè¸ªå¯¼å¼¹',
                description: 'æ©™çº¢è‰²ï¼Œè‡ªåŠ¨è¿½è¸ªæ•Œæœº',
                color: '#ff4400'
            },
            {
                type: 'upgraded',
                name: 'å‡çº§å­å¼¹',
                description: 'ç»¿è‰²èƒ½é‡ç®­çŸ¢ï¼Œå‡çº§ç‰ˆå­å¼¹',
                color: '#00cc66'
            }
        ];

        // é“å…·ç±»å‹é…ç½®
        const powerupTypes = [
            {
                type: 'health',
                name: 'èŠ±èœœ',
                description: 'æ¢å¤ç”Ÿå‘½å€¼',
                color: '#ff0080'
            },
            {
                type: 'shield',
                name: 'èœ‚èœ¡',
                description: 'å¢åŠ ä¿æŠ¤å…‰åœˆ',
                color: '#0080ff'
            },
            {
                type: 'rapidFire',
                name: 'èœ‚èœœ',
                description: 'å¿«é€Ÿå°„å‡»',
                color: '#ffff00'
            },
            {
                type: 'bulletUpgrade',
                name: 'å¼ºåŒ–èœ‚é’ˆ',
                description: 'å­å¼¹å‡çº§',
                color: '#ff6600'
            }
        ];

        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            // è®¾ç½®å…¨å±€canvaså’Œctx
            window.canvas = { width: 800, height: 600 };
            
            createEnemyDisplays();
            createBulletDisplays();
            createPowerupDisplays();
            createPlayerDisplay();
        }

        // åˆ›å»ºæ•Œæœºå±•ç¤º
        function createEnemyDisplays() {
            const container = document.getElementById('enemyContainer');
            
            enemyTypes.forEach(config => {
                const div = document.createElement('div');
                const canvas = document.createElement('canvas');
                canvas.className = 'test-canvas';
                canvas.width = 200;
                canvas.height = 150;
                canvas.id = `enemy-${config.type}`;
                
                const info = document.createElement('div');
                info.className = 'element-info';
                
                // åˆ›å»ºæ•Œæœºå®ä¾‹è·å–å±æ€§
                const enemy = new Enemy(100, 75, config.type, config.color);
                
                info.innerHTML = `
                    <strong>${config.name}</strong>
                    <div class="description">${config.description}</div>
                    <div class="stats">
                        <div class="stat-item">å°ºå¯¸: ${enemy.width}x${enemy.height}</div>
                        <div class="stat-item">è¡€é‡: ${enemy.health}</div>
                        <div class="stat-item">é€Ÿåº¦: ${enemy.speed}</div>
                        <div class="stat-item">å°„å‡»é—´éš”: ${enemy.shootInterval}</div>
                        <div class="stat-item">é¢œè‰²: <span style="color: ${enemy.color}; font-weight: bold;">${enemy.color}</span></div>
                    </div>
                    <button class="toggle-params" onclick="toggleParams('enemy-${config.type}')">è°ƒæ•´å‚æ•°</button>
                    <div class="param-controls" id="params-enemy-${config.type}" style="display: none;">
                        <div class="param-group">
                            <label>å®½åº¦:</label>
                            <input type="range" min="10" max="100" value="${enemy.width}" 
                                   onchange="updateEnemyParam('${config.type}', 'width', this.value)" 
                                   oninput="syncInputValue('width-enemy-${config.type}', this.value)">
                            <input type="number" min="10" max="100" value="${enemy.width}" 
                                   onchange="updateEnemyParamFromInput('${config.type}', 'width', this.value)" 
                                   id="width-enemy-${config.type}-input" class="number-input">
                        </div>
                        <div class="param-group">
                            <label>é«˜åº¦:</label>
                            <input type="range" min="10" max="100" value="${enemy.height}" 
                                   onchange="updateEnemyParam('${config.type}', 'height', this.value)" 
                                   oninput="syncInputValue('height-enemy-${config.type}', this.value)">
                            <input type="number" min="10" max="100" value="${enemy.height}" 
                                   onchange="updateEnemyParamFromInput('${config.type}', 'height', this.value)" 
                                   id="height-enemy-${config.type}-input" class="number-input">
                        </div>
                        <div class="param-group">
                            <label>è¡€é‡:</label>
                            <input type="range" min="1" max="50" value="${enemy.health}" 
                                   onchange="updateEnemyParam('${config.type}', 'health', this.value)" 
                                   oninput="syncInputValue('health-enemy-${config.type}', this.value)">
                            <input type="number" min="1" max="50" value="${enemy.health}" 
                                   onchange="updateEnemyParamFromInput('${config.type}', 'health', this.value)" 
                                   id="health-enemy-${config.type}-input" class="number-input">
                        </div>
                        <div class="param-group">
                            <label>é€Ÿåº¦:</label>
                            <input type="range" min="0.5" max="10" step="0.5" value="${enemy.speed}" 
                                   onchange="updateEnemyParam('${config.type}', 'speed', this.value)" 
                                   oninput="syncInputValue('speed-enemy-${config.type}', this.value)">
                            <input type="number" min="0.5" max="10" step="0.5" value="${enemy.speed}" 
                                   onchange="updateEnemyParamFromInput('${config.type}', 'speed', this.value)" 
                                   id="speed-enemy-${config.type}-input" class="number-input">
                        </div>
                        <div class="param-group">
                            <label>é¢œè‰²:</label>
                            <input type="color" value="${enemy.color}" 
                                   onchange="updateEnemyParam('${config.type}', 'color', this.value)">
                        </div>
                    </div>
                `;
                
                div.appendChild(canvas);
                div.appendChild(info);
                container.appendChild(div);
                
                // å­˜å‚¨æ•Œæœºå®ä¾‹
                enemyInstances[config.type] = enemy;
                
                // ç»˜åˆ¶é™æ€æ•Œæœº
                drawStaticEnemy(canvas, enemy);
            });
        }

        // åˆ›å»ºå­å¼¹å±•ç¤º
        function createBulletDisplays() {
            const container = document.getElementById('bulletContainer');
            
            bulletTypes.forEach(config => {
                const div = document.createElement('div');
                const canvas = document.createElement('canvas');
                canvas.className = 'test-canvas';
                canvas.width = 150;
                canvas.height = 100;
                canvas.id = `bullet-${config.type}`;
                
                const info = document.createElement('div');
                info.className = 'element-info';
                
                // åˆ›å»ºå­å¼¹å®ä¾‹è·å–å±æ€§
                const bullet = new Bullet(75, 50, 3, config.color, config.type, 0, 0.1);
                // åˆå§‹åŒ–æ–°å‚æ•°
                bullet.angle = 0;
                bullet.rotationSpeed = 0.1;
                bullet.followShootDirection = false;
                bullet.enableRotation = false;
                
                info.innerHTML = `
                    <strong>${config.name}</strong>
                    <div class="description">${config.description}</div>
                    <div class="stats">
                        <div class="stat-item">å°ºå¯¸: ${bullet.width}x${bullet.height}</div>
                        <div class="stat-item">é¢œè‰²: <span style="color: ${bullet.color}; font-weight: bold;">${bullet.color}</span></div>
                        <div class="stat-item">ç±»å‹: ${bullet.type}</div>
                    </div>
                    <button class="toggle-params" onclick="toggleParams('bullet-${config.type}')">è°ƒæ•´å‚æ•°</button>
                    <div class="param-controls" id="params-bullet-${config.type}" style="display: none;">
                        <div class="param-group">
                            <label>å®½åº¦:</label>
                            <input type="range" min="2" max="30" value="${bullet.width}" 
                                   onchange="updateBulletParam('${config.type}', 'width', this.value)" 
                                   oninput="syncInputValue('width-bullet-${config.type}', this.value)">
                            <input type="number" min="2" max="30" value="${bullet.width}" 
                                   onchange="updateBulletParamFromInput('${config.type}', 'width', this.value)" 
                                   id="width-bullet-${config.type}-input" class="number-input">
                        </div>
                        <div class="param-group">
                            <label>é«˜åº¦:</label>
                            <input type="range" min="2" max="30" value="${bullet.height}" 
                                   onchange="updateBulletParam('${config.type}', 'height', this.value)" 
                                   oninput="syncInputValue('height-bullet-${config.type}', this.value)">
                            <input type="number" min="2" max="30" value="${bullet.height}" 
                                   onchange="updateBulletParamFromInput('${config.type}', 'height', this.value)" 
                                   id="height-bullet-${config.type}-input" class="number-input">
                        </div>
                        <div class="param-group">
                            <label>é¢œè‰²:</label>
                            <input type="color" value="${bullet.color}" 
                                   onchange="updateBulletParam('${config.type}', 'color', this.value)">
                        </div>
                        <div class="param-group">
                            <label>é€Ÿåº¦:</label>
                            <input type="range" min="1" max="20" value="${Math.abs(bullet.vy)}" 
                                   onchange="updateBulletParam('${config.type}', 'speed', this.value)" 
                                   oninput="syncInputValue('speed-bullet-${config.type}', this.value)">
                            <input type="number" min="1" max="20" value="${Math.abs(bullet.vy)}" 
                                   onchange="updateBulletParamFromInput('${config.type}', 'speed', this.value)" 
                                   id="speed-bullet-${config.type}-input" class="number-input">
                        </div>
                        <div class="param-group">
                            <label>æ–¹å‘æ§åˆ¶:</label>
                            <input type="checkbox" id="followShootDirection-bullet-${config.type}" 
                                   onchange="updateBulletParam('${config.type}', 'followShootDirection', this.checked)">
                            <label for="followShootDirection-bullet-${config.type}" style="min-width: auto; margin-left: 5px;">è·Ÿéšå°„å‡»æ–¹å‘</label>
                        </div>
                        <div class="param-group" id="angleControls-bullet-${config.type}" style="display: block;">
                            <label>æ–¹å‘è§’åº¦:</label>
                            <input type="range" min="-180" max="180" value="${Math.round(bullet.angle * 180 / Math.PI)}" 
                                   onchange="updateBulletParam('${config.type}', 'angle', this.value)" 
                                   oninput="syncInputValue('angle-bullet-${config.type}', this.value)">
                            <input type="number" min="-180" max="180" value="${Math.round(bullet.angle * 180 / Math.PI)}" 
                                   onchange="updateBulletParamFromInput('${config.type}', 'angle', this.value)" 
                                   id="angle-bullet-${config.type}-input" class="number-input">
                            <span class="value-display">${Math.round(bullet.angle * 180 / Math.PI)}Â°</span>
                        </div>
                        <div class="param-group">
                            <label>æ—‹è½¬æ§åˆ¶:</label>
                            <input type="checkbox" id="enableRotation-bullet-${config.type}" 
                                   onchange="updateBulletParam('${config.type}', 'enableRotation', this.checked)">
                            <label for="enableRotation-bullet-${config.type}" style="min-width: auto; margin-left: 5px;">æ˜¯å¦æ—‹è½¬</label>
                        </div>
                        <div class="param-group" id="rotationControls-bullet-${config.type}" style="display: none;">
                            <label>æ—‹è½¬é€Ÿåº¦:</label>
                            <input type="range" min="0" max="1" step="0.05" value="${bullet.rotationSpeed || 0.1}" 
                                   onchange="updateBulletParam('${config.type}', 'rotationSpeed', this.value)" 
                                   oninput="syncInputValue('rotationSpeed-bullet-${config.type}', this.value)">
                            <input type="number" min="0" max="1" step="0.05" value="${bullet.rotationSpeed || 0.1}" 
                                   onchange="updateBulletParamFromInput('${config.type}', 'rotationSpeed', this.value)" 
                                   id="rotationSpeed-bullet-${config.type}-input" class="number-input">
                            <span class="value-display">${(bullet.rotationSpeed || 0.1).toFixed(2)}</span>
                        </div>
                    </div>
                `;
                
                div.appendChild(canvas);
                div.appendChild(info);
                container.appendChild(div);
                
                // å­˜å‚¨å­å¼¹å®ä¾‹
                bulletInstances[config.type] = bullet;
                
                // ç»˜åˆ¶é™æ€å­å¼¹
                drawStaticBullet(canvas, bullet);
            });
        }

        // åˆ›å»ºé“å…·å±•ç¤º
        function createPowerupDisplays() {
            const container = document.getElementById('powerupContainer');
            
            powerupTypes.forEach(config => {
                const div = document.createElement('div');
                const canvas = document.createElement('canvas');
                canvas.className = 'test-canvas';
                canvas.width = 150;
                canvas.height = 100;
                canvas.id = `powerup-${config.type}`;
                
                const info = document.createElement('div');
                info.className = 'element-info';
                
                info.innerHTML = `
                    <strong>${config.name}</strong>
                    <div class="description">${config.description}</div>
                    <div class="stats">
                        <div class="stat-item">å°ºå¯¸: 25x25</div>
                        <div class="stat-item">é¢œè‰²: <span style="color: ${config.color}; font-weight: bold;">${config.color}</span></div>
                        <div class="stat-item">ç±»å‹: ${config.type}</div>
                    </div>
                    <button class="toggle-params" onclick="toggleParams('powerup-${config.type}')">è°ƒæ•´å‚æ•°</button>
                    <div class="param-controls" id="params-powerup-${config.type}" style="display: none;">
                        <div class="param-group">
                            <label>å°ºå¯¸:</label>
                            <input type="range" min="15" max="50" value="25" 
                                   onchange="updatePowerupParam('${config.type}', 'size', this.value)" 
                                   oninput="syncInputValue('size-powerup-${config.type}', this.value)">
                            <input type="number" min="15" max="50" value="25" 
                                   onchange="updatePowerupParamFromInput('${config.type}', 'size', this.value)" 
                                   id="size-powerup-${config.type}-input" class="number-input">
                        </div>
                        <div class="param-group">
                            <label>é¢œè‰²:</label>
                            <input type="color" value="${config.color}" 
                                   onchange="updatePowerupParam('${config.type}', 'color', this.value)">
                        </div>
                        <div class="param-group">
                            <label>é€Ÿåº¦:</label>
                            <input type="range" min="0.5" max="5" step="0.5" value="2" 
                                   onchange="updatePowerupParam('${config.type}', 'speed', this.value)" 
                                   oninput="syncInputValue('speed-powerup-${config.type}', this.value)">
                            <input type="number" min="0.5" max="5" step="0.5" value="2" 
                                   onchange="updatePowerupParamFromInput('${config.type}', 'speed', this.value)" 
                                   id="speed-powerup-${config.type}-input" class="number-input">
                        </div>
                    </div>
                `;
                
                div.appendChild(canvas);
                div.appendChild(info);
                container.appendChild(div);
                
                // ç»˜åˆ¶é™æ€é“å…·
                drawStaticPowerup(canvas, config);
            });
        }

        // åˆ›å»ºç©å®¶å±•ç¤º
        function createPlayerDisplay() {
            const canvas = document.getElementById('playerCanvas');
            drawStaticPlayer(canvas);
        }

        // ç»˜åˆ¶é™æ€æ•Œæœº
        function drawStaticEnemy(canvas, enemy) {
            const ctx = canvas.getContext('2d');
            window.ctx = ctx; // è®¾ç½®å…¨å±€ctx
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // å±…ä¸­ç»˜åˆ¶
            enemy.x = (canvas.width - enemy.width) / 2;
            enemy.y = (canvas.height - enemy.height) / 2;
            
            enemy.draw();
        }

        // ç»˜åˆ¶é™æ€å­å¼¹
        function drawStaticBullet(canvas, bullet) {
            const ctx = canvas.getContext('2d');
            window.ctx = ctx;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // å±…ä¸­ç»˜åˆ¶
            bullet.x = (canvas.width - bullet.width) / 2;
            bullet.y = (canvas.height - bullet.height) / 2;
            
            bullet.draw();
        }

        // ç»˜åˆ¶é™æ€é“å…·
        function drawStaticPowerup(canvas, config) {
            const ctx = canvas.getContext('2d');
            window.ctx = ctx;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // åˆ›å»ºé“å…·å®ä¾‹
            const powerup = new PowerUp(canvas.width/2 - 12.5, canvas.height/2 - 12.5, config.type, config.color);
            
            // å­˜å‚¨é“å…·å®ä¾‹
            powerupInstances[config.type] = powerup;
            
            powerup.draw();
        }

        // ç»˜åˆ¶é™æ€ç©å®¶
        function drawStaticPlayer(canvas) {
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ç©å®¶é£æœºï¼ˆå°èœœèœ‚ï¼‰
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // èº«ä½“ï¼ˆæ¤­åœ†å½¢ï¼‰
            ctx.fillStyle = '#ffff00';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY, 15, 10, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // é»‘è‰²æ¡çº¹
            ctx.fillStyle = '#000000';
            for (let i = 0; i < 3; i++) {
                ctx.fillRect(centerX - 12 + i * 8, centerY - 8, 3, 16);
            }
            
            // ç¿…è†€
            ctx.fillStyle = '#ffffff';
            ctx.globalAlpha = 0.8;
            // å·¦ç¿…è†€
            ctx.beginPath();
            ctx.ellipse(centerX - 18, centerY - 5, 8, 12, -0.3, 0, Math.PI * 2);
            ctx.fill();
            // å³ç¿…è†€
            ctx.beginPath();
            ctx.ellipse(centerX + 18, centerY - 5, 8, 12, 0.3, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.globalAlpha = 1.0;
            
            // çœ¼ç›
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.arc(centerX - 5, centerY - 3, 2, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(centerX + 5, centerY - 3, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // è§¦è§’
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX - 3, centerY - 10);
            ctx.lineTo(centerX - 6, centerY - 15);
            ctx.moveTo(centerX + 3, centerY - 10);
            ctx.lineTo(centerX + 6, centerY - 15);
            ctx.stroke();
            
            // è§¦è§’æœ«ç«¯
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.arc(centerX - 6, centerY - 15, 1.5, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(centerX + 6, centerY - 15, 1.5, 0, Math.PI * 2);
            ctx.fill();
        }

        // åŠ¨ç”»æ§åˆ¶
        function startAnimation() {
            if (animationRunning) return;
            
            animationRunning = true;
            document.getElementById('animBtn').classList.add('active');
            animate();
        }

        function stopAnimation() {
            animationRunning = false;
            document.getElementById('animBtn').classList.remove('active');
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        }

        function resetAll() {
            stopAnimation();
            init();
        }

        function animate() {
            if (!animationRunning) return;
            
            // æ›´æ–°æ‰€æœ‰åŠ¨ç”»å…ƒç´ 
            updateAnimations();
            
            animationId = requestAnimationFrame(animate);
        }

        function updateAnimations() {
            // æ›´æ–°é“å…·åŠ¨ç”»
            powerupTypes.forEach(config => {
                const canvas = document.getElementById(`powerup-${config.type}`);
                if (canvas) {
                    drawStaticPowerup(canvas, config);
                }
            });
            
            // æ›´æ–°å­å¼¹åŠ¨ç”»
            bulletTypes.forEach(config => {
                const canvas = document.getElementById(`bullet-${config.type}`);
                if (canvas) {
                    const bullet = bulletInstances[config.type] || new Bullet(75, 50, 3, config.color, config.type, 0, 0.1);
                    bullet.animationTimer += 0.3;
                    drawStaticBullet(canvas, bullet);
                }
            });
        }

        // å‚æ•°æ§åˆ¶å‡½æ•°
        function toggleParams(elementId) {
            const paramsDiv = document.getElementById(`params-${elementId}`);
            if (paramsDiv.style.display === 'none') {
                paramsDiv.style.display = 'block';
            } else {
                paramsDiv.style.display = 'none';
            }
        }

        // åŒæ­¥æ»‘å—å’Œæ•°å­—è¾“å…¥æ¡†çš„å€¼
        function syncInputValue(paramId, value) {
            const inputElement = document.getElementById(`${paramId}-input`);
            if (inputElement) {
                inputElement.value = value;
            }
        }
        
        // ä»æ•°å­—è¾“å…¥æ¡†æ›´æ–°æ»‘å—å’Œå‚æ•°
        function syncSliderValue(paramId, value) {
            const sliderElement = document.querySelector(`input[oninput*="${paramId}"]`);
            if (sliderElement) {
                sliderElement.value = value;
            }
        }

        function updateEnemyParam(type, param, value) {
            const enemy = enemyInstances[type];
            if (!enemy) return;
            
            // æ›´æ–°å‚æ•°
            if (param === 'width' || param === 'height' || param === 'health') {
                enemy[param] = parseInt(value);
            } else if (param === 'speed') {
                enemy[param] = parseFloat(value);
            } else if (param === 'color') {
                enemy[param] = value;
            }
            
            // é‡æ–°ç»˜åˆ¶
            const canvas = document.getElementById(`enemy-${type}`);
            if (canvas) {
                drawStaticEnemy(canvas, enemy);
            }
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateEnemyStats(type, enemy);
        }
        
        function updateEnemyParamFromInput(type, param, value) {
            // åŒæ­¥æ»‘å—å€¼
            syncSliderValue(`${param}-enemy-${type}`, value);
            // è°ƒç”¨åŸæœ‰çš„æ›´æ–°å‡½æ•°
            updateEnemyParam(type, param, value);
        }

        function updateBulletParam(type, param, value) {
            const bullet = bulletInstances[type];
            if (!bullet) return;
            
            // æ›´æ–°å‚æ•°
            if (param === 'width' || param === 'height') {
                bullet[param] = parseInt(value);
            } else if (param === 'color') {
                bullet[param] = value;
                bullet.glowColor = value; // åŒæ—¶æ›´æ–°å‘å…‰é¢œè‰²
            } else if (param === 'speed') {
                const speed = parseFloat(value);
                bullet.vy = bullet.vy < 0 ? -speed : speed;
                bullet.vx = bullet.vx < 0 ? -speed : speed;
            } else if (param === 'followShootDirection') {
                bullet.followShootDirection = value;
                // æ§åˆ¶è§’åº¦æ§ä»¶çš„æ˜¾ç¤º/éšè—
                const angleControls = document.getElementById(`angleControls-bullet-${type}`);
                if (angleControls) {
                    angleControls.style.display = value ? 'none' : 'block';
                }
                if (value) {
                    // å¦‚æœå¯ç”¨è·Ÿéšå°„å‡»æ–¹å‘ï¼Œè®¾ç½®é»˜è®¤å‘ä¸‹çš„è§’åº¦
                    bullet.angle = Math.PI / 2; // 90åº¦ï¼Œå‘ä¸‹
                    const speed = Math.sqrt(bullet.vx * bullet.vx + bullet.vy * bullet.vy);
                    bullet.vx = Math.cos(bullet.angle) * speed;
                    bullet.vy = Math.sin(bullet.angle) * speed;
                } else {
                    // å¦‚æœä¸è·Ÿéšå°„å‡»æ–¹å‘ï¼Œé‡ç½®ä¸ºé»˜è®¤é€Ÿåº¦
                    bullet.angle = 0;
                    const speed = Math.sqrt(bullet.vx * bullet.vx + bullet.vy * bullet.vy);
                    bullet.vx = 0;
                    bullet.vy = bullet.vy < 0 ? -speed : speed;
                }
            } else if (param === 'enableRotation') {
                bullet.enableRotation = value;
                // æ§åˆ¶æ—‹è½¬æ§ä»¶çš„æ˜¾ç¤º/éšè—
                const rotationControls = document.getElementById(`rotationControls-bullet-${type}`);
                if (rotationControls) {
                    rotationControls.style.display = value ? 'block' : 'none';
                }
                if (value) {
                    bullet.rotationSpeed = bullet.rotationSpeed || 0.1; // é»˜è®¤æ—‹è½¬é€Ÿåº¦
                } else {
                    bullet.rotationSpeed = 0;
                }
            } else if (param === 'angle') {
                bullet.angle = parseFloat(value);
                // æ ¹æ®è§’åº¦æ›´æ–°é€Ÿåº¦åˆ†é‡
                const speed = Math.sqrt(bullet.vx * bullet.vx + bullet.vy * bullet.vy);
                const angleRad = (bullet.angle * Math.PI) / 180;
                bullet.vx = Math.cos(angleRad) * speed;
                bullet.vy = Math.sin(angleRad) * speed;
            } else if (param === 'rotationSpeed') {
                bullet.rotationSpeed = parseFloat(value);
            }
            
            // é‡æ–°ç»˜åˆ¶
            const canvas = document.getElementById(`bullet-${type}`);
            if (canvas) {
                drawStaticBullet(canvas, bullet);
            }
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateBulletStats(type, bullet);
        }
        
        function updateBulletParamFromInput(type, param, value) {
            // åŒæ­¥æ»‘å—å€¼
            syncSliderValue(`${param}-bullet-${type}`, value);
            // è°ƒç”¨åŸæœ‰çš„æ›´æ–°å‡½æ•°
            updateBulletParam(type, param, value);
        }

        function updateEnemyStats(type, enemy) {
            const container = document.querySelector(`#enemy-${type}`).parentNode;
            const statsDiv = container.querySelector('.stats');
            if (statsDiv) {
                statsDiv.innerHTML = `
                    <div class="stat-item">å°ºå¯¸: ${enemy.width}x${enemy.height}</div>
                    <div class="stat-item">è¡€é‡: ${enemy.health}</div>
                    <div class="stat-item">é€Ÿåº¦: ${enemy.speed}</div>
                    <div class="stat-item">å°„å‡»é—´éš”: ${enemy.shootInterval}</div>
                    <div class="stat-item">é¢œè‰²: <span style="color: ${enemy.color}; font-weight: bold;">${enemy.color}</span></div>
                `;
            }
        }

        function updateBulletStats(type, bullet) {
             const container = document.querySelector(`#bullet-${type}`).parentNode;
             const statsDiv = container.querySelector('.stats');
             if (statsDiv) {
                 const followDirection = bullet.followShootDirection ? 'æ˜¯' : 'å¦';
                 const enableRotation = bullet.enableRotation ? 'æ˜¯' : 'å¦';
                 statsDiv.innerHTML = `
                     <div class="stat-item">å°ºå¯¸: ${bullet.width}x${bullet.height}</div>
                     <div class="stat-item">é¢œè‰²: <span style="color: ${bullet.color}; font-weight: bold;">${bullet.color}</span></div>
                     <div class="stat-item">ç±»å‹: ${bullet.type}</div>
                     <div class="stat-item">è·Ÿéšå°„å‡»æ–¹å‘: ${followDirection}</div>
                     <div class="stat-item">å¯ç”¨æ—‹è½¬: ${enableRotation}</div>
                 `;
             }
         }

         function updatePowerupParam(type, param, value) {
             const powerup = powerupInstances[type];
             if (!powerup) return;
             
             // æ›´æ–°å‚æ•°
             if (param === 'size') {
                 powerup.size = parseInt(value);
                 powerup.width = powerup.size;
                 powerup.height = powerup.size;
             } else if (param === 'color') {
                 powerup.color = value;
             } else if (param === 'speed') {
                 powerup.speed = parseFloat(value);
                 powerup.vx = powerup.vx < 0 ? -powerup.speed : powerup.speed;
                 powerup.vy = powerup.vy < 0 ? -powerup.speed : powerup.speed;
             }
             
             // é‡æ–°ç»˜åˆ¶
             const canvas = document.getElementById(`powerup-${type}`);
             if (canvas) {
                 drawStaticPowerup(canvas, {type: type, color: powerup.color});
             }
             
             // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
             updatePowerupStats(type, powerup);
         }
         
         function updatePowerupParamFromInput(type, param, value) {
             // åŒæ­¥æ»‘å—å€¼
             syncSliderValue(`${param}-powerup-${type}`, value);
             // è°ƒç”¨åŸæœ‰çš„æ›´æ–°å‡½æ•°
             updatePowerupParam(type, param, value);
         }

         function updatePowerupStats(type, powerup) {
             const container = document.querySelector(`#powerup-${type}`).parentNode;
             const statsDiv = container.querySelector('.stats');
             if (statsDiv) {
                 const size = powerup.size || 25;
                 statsDiv.innerHTML = `
                     <div class="stat-item">å°ºå¯¸: ${size}x${size}</div>
                     <div class="stat-item">é¢œè‰²: <span style="color: ${powerup.color}; font-weight: bold;">${powerup.color}</span></div>
                     <div class="stat-item">ç±»å‹: ${powerup.type}</div>
                 `;
             }
         }

        // ä¿å­˜åˆ°æºæ–‡ä»¶
        async function saveToFiles() {
            try {
                // æ›´æ–°bullet.jsæ–‡ä»¶
                await updateBulletFile();
                
                // æ›´æ–°enemy.jsæ–‡ä»¶
                await updateEnemyFile();
                
                alert('é…ç½®å·²æˆåŠŸä¿å­˜åˆ°æºæ–‡ä»¶ï¼');
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        }
        
        async function updateBulletFile() {
            // æ„å»ºæ–°çš„å­å¼¹ç±»å‹é…ç½®
            const bulletConfigs = {};
            Object.keys(bulletInstances).forEach(type => {
                const bullet = bulletInstances[type];
                bulletConfigs[type] = {
                    width: bullet.width,
                    height: bullet.height,
                    color: bullet.color,
                    glowColor: bullet.glowColor || bullet.color
                };
            });
            
            console.log('æ­£åœ¨æ›´æ–°å­å¼¹é…ç½®ï¼š', bulletConfigs);
            
            // è°ƒç”¨æœåŠ¡å™¨APIæ›´æ–°æ–‡ä»¶
            const response = await fetch('http://localhost:3001/api/update-bullets', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ bulletConfigs })
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const result = await response.json();
            if (!result.success) {
                throw new Error(result.error || 'æ›´æ–°å­å¼¹é…ç½®å¤±è´¥');
            }
            
            console.log('bullet.js æ–‡ä»¶å·²æ›´æ–°');
        }
        
        async function updateEnemyFile() {
            // æ„å»ºæ–°çš„æ•Œæœºç±»å‹é…ç½®
            const enemyConfigs = {};
            Object.keys(enemyInstances).forEach(type => {
                const enemy = enemyInstances[type];
                enemyConfigs[type] = {
                    width: enemy.width,
                    height: enemy.height,
                    health: enemy.health,
                    speed: enemy.speed,
                    color: enemy.color
                };
            });
            
            console.log('æ­£åœ¨æ›´æ–°æ•Œæœºé…ç½®ï¼š', enemyConfigs);
            
            // è°ƒç”¨æœåŠ¡å™¨APIæ›´æ–°æ–‡ä»¶
            const response = await fetch('http://localhost:3001/api/update-enemies', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ enemyConfigs })
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const result = await response.json();
            if (!result.success) {
                throw new Error(result.error || 'æ›´æ–°æ•Œæœºé…ç½®å¤±è´¥');
            }
            
            console.log('enemy.js æ–‡ä»¶å·²æ›´æ–°');
        }

        // å¯¼å‡ºå‚æ•°é…ç½®
        function exportConfig() {
            const config = {
                enemies: {},
                bullets: {}
            };
            
            // å¯¼å‡ºæ•Œæœºé…ç½®
            Object.keys(enemyInstances).forEach(type => {
                const enemy = enemyInstances[type];
                config.enemies[type] = {
                    width: enemy.width,
                    height: enemy.height,
                    health: enemy.health,
                    speed: enemy.speed,
                    color: enemy.color
                };
            });
            
            // å¯¼å‡ºå­å¼¹é…ç½®
             Object.keys(bulletInstances).forEach(type => {
                 const bullet = bulletInstances[type];
                 config.bullets[type] = {
                     width: bullet.width,
                     height: bullet.height,
                     color: bullet.color,
                     speed: Math.abs(bullet.vy)
                 };
             });
             
             // å¯¼å‡ºé“å…·é…ç½®
             config.powerups = {};
             Object.keys(powerupInstances).forEach(type => {
                 const powerup = powerupInstances[type];
                 config.powerups[type] = {
                     size: powerup.size || 25,
                     color: powerup.color,
                     speed: powerup.speed || 2
                 };
             });
            
            // ä¸‹è½½é…ç½®æ–‡ä»¶
            const dataStr = JSON.stringify(config, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'game_config.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>